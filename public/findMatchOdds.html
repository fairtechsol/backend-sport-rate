<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Match Odds Rate</title>
</head>

<body>
    <div id="events"></div>

    <script>
        document.addEventListener("DOMContentLoaded", async function () {
            let index = 1;
            const eventsResponse = await fetch("http://107.23.165.155:3200/competitionList?type=cricket");
            const eventsData = await eventsResponse.json();

            const eventsContainer = document.getElementById("events");

            for (const event of eventsData) {
                const competitionId = event.competition.id;

                const marketsResponse = await fetch(`http://107.23.165.155:3200/eventList/${competitionId}`);
                const marketsData = await marketsResponse.json();

                const dataDiv = document.createElement("div");
                dataDiv.style.margin = "20px";
                eventsContainer.appendChild(dataDiv);

                for (const market of marketsData) {
                    const eventID = market.event.id;

                    const dataResponse = await fetch(`http://107.23.165.155:3200/extraMarketList/${eventID}?eventType=cricket`);
                    const data = await dataResponse.json();

                    let marketIds = []

                    for (const market of data) {
                        marketIds.push(market.marketId);
                    }

                    console.log(market?.event?.name, "  ", market?.competition?.name, " ", marketIds);

                    const marketRates = await fetch(`http://107.23.165.155:3200/matchOddsNew/${marketIds.join(',')}`);
                    const rate = await marketRates.json();
                    console.log(rate);
                    let len = rate.filter(l => { if (l) { return true } else { return false } })


                    const dataDiv = document.createElement("div");
                    dataDiv.style.margin = "10px";
                    dataDiv.textContent = index + "  => " + market?.competition?.name + " ------ " + market?.event?.name;
                    let textContent = (new Date(market.marketStartTime)).toLocaleString();
                    const dataDiv1 = document.createElement("div");
                    dataDiv1.style.marginLeft = "70px";

                    textContent = textContent + " ----- " + len.length;

                    dataDiv1.textContent = textContent;
                    dataDiv.appendChild(dataDiv1);
                    eventsContainer.appendChild(dataDiv);
                    dataDiv.scrollIntoView({ behavior: "smooth", block: "end", inline: "nearest" });
                    index++;
                }
            }
        });

    </script>
</body>

</html>